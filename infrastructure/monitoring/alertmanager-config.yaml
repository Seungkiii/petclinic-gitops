apiVersion: v1
kind: ConfigMap
metadata:
  name: alertmanager-config
  namespace: monitoring
data:
  alertmanager.yml: |
    global:
      resolve_timeout: 5m
      slack_api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
    
    route:
      group_by: ['alertname', 'severity']
      group_wait: 10s        # ì•Œë¦¼ ê·¸ë£¹í™” ëŒ€ê¸° ì‹œê°„
      group_interval: 5m     # ê°™ì€ ê·¸ë£¹ ì¬ì „ì†¡ ê°„ê²©
      repeat_interval: 4h    # ë¯¸í•´ê²° ì‹œ ë°˜ë³µ ì•Œë¦¼
      receiver: 'slack-scaling'
      
      routes:
        # Critical: ì¦‰ì‹œ ì•Œë¦¼ (PagerDuty ë“± ì¶”ê°€ ê°€ëŠ¥)
        - match:
            severity: critical
          receiver: 'slack-critical'
          repeat_interval: 1h
        
        # Warning: HPA, Karpenter ìŠ¤ì¼€ì¼ë§
        - match:
            severity: warning
          receiver: 'slack-scaling'
          repeat_interval: 4h
        
        # Info: ì¼ë°˜ ì •ë³´
        - match:
            severity: info
          receiver: ê°„ìƒ‰)
      - name: 'slack-critical'
        slack_configs:
          - channel: '#alerts-critical'
            color: 'danger'
            title: 'ğŸš¨ Critical Alert'
            text: |-
              {{ range .Alerts }}
              *Alert:* {{ .Labels.alertname }}
              *Description:* {{ .Annotations.description }}
              *Details:*
              {{ range .Labels.SortedPairs }} â€¢ *{{ .Name }}:* {{ .Value }}
              {{ end }}
              {{ end }}
      
      # Scaling ì „ìš© (ì£¼í™©ìƒ‰)
      - name: 'slack-scaling'
        slack_configs:
          - channel: '#petclinic-alerts'
            color: 'warning'
            title: 'âš¡ Scaling Alert'
            text: |-
              {{ range .Alerts }}
              *Alert:* {{ .Labels.alertname }}
              *Summary:* {{ .Annotations.summary }}
              *Description:* {{ .Annotations.description }}
              {{ end }}
            send_resolved: true
      
      # Info ì „ìš© (íŒŒë€ìƒ‰)
      - name: 'slack-info     - channel: '#alerts-info'
            color: 'good'
            title: 'â„¹ï¸ Info Alert'
            text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
            send_resolved: true
